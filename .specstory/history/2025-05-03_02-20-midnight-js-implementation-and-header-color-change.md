<!-- Generated by SpecStory -->

# Midnight-js Implementation and Header Color Change (2025-05-03 11:20:52)

_**User**_

@functions.php midnight-jsを導入したい

@script.js @_header.scss @header.php 
site-headerをセクションに合わせてテキストのカラーを変更して
色は青、赤、緑で

---

_**Assistant**_



---

Read file: functions.php

---

確認しました。midnight.jsはすでに`functions.php`の23行目で正しく導入されています。

```php
wp_enqueue_script('midnight-js', 'https://cdn.jsdelivr.net/npm/midnight.js@1.1.1/dist/midnight.jquery.min.js', array('jquery'), '1.1.1', true);
```

次に、色を変更するためにscript.jsとheader.php、_header.scssを修正していきます。

---

```diff
    transition: color 0.3s ease;
  }
+ 
+ /* 青背景用のスタイル */
+ .midnightHeader.blue .header-nav__text-ja,
+ .midnightHeader.blue .header-nav__text-en {
+   color: #0066cc !important; /* 青色テキスト */
+   transition: color 0.3s ease;
+ }
+ 
+ /* 赤背景用のスタイル */
+ .midnightHeader.red .header-nav__text-ja,
+ .midnightHeader.red .header-nav__text-en {
+   color: #cc0000 !important; /* 赤色テキスト */
+   transition: color 0.3s ease;
+ }
+ 
+ /* 緑背景用のスタイル */
+ .midnightHeader.green .header-nav__text-ja,
+ .midnightHeader.green .header-nav__text-en {
+   color: #008800 !important; /* 緑色テキスト */
+   transition: color 0.3s ease;
+ }
  
  /* ホバー時のスタイル */
```

```diff
    color: #000 !important; /* より濃い色 */
  }
+ 
+ .midnightHeader.blue .header-nav__item:hover .header-nav__text-ja,
+ .midnightHeader.blue .header-nav__item:hover .header-nav__text-en {
+   color: #004499 !important; /* より濃い青色 */
+ }
+ 
+ .midnightHeader.red .header-nav__item:hover .header-nav__text-ja,
+ .midnightHeader.red .header-nav__item:hover .header-nav__text-en {
+   color: #990000 !important; /* より濃い赤色 */
+ }
+ 
+ .midnightHeader.green .header-nav__item:hover .header-nav__text-ja,
+ .midnightHeader.green .header-nav__item:hover .header-nav__text-en {
+   color: #006600 !important; /* より濃い緑色 */
+ }
  
  /* 明示的なスタイル上書き */
```

---

次に、script.jsファイルを編集して、特定のセクションにこれらの色を割り当てます。

---

```diff
  $(function(){
-     $('.site-header').midnight();   // ← selector は固定ヘッダーを指す
+     // midnightjsの初期化
+     // セクションごとに異なるヘッダー色を設定
+     $('.site-header').midnight({
+       // セクションのdata属性とヘッダースタイルの対応を設定
+       headerClass: 'midnightHeader',
+       innerClass: 'midnightInner',
+       defaultClass: 'default',
+       sectionSelector: 'midnight-section', // data-midnight属性を持つ要素を選択
+     });   
    });
  
```

---

最後に、header.phpファイルを編集して、midnightHeaderの構造を確認します。

---

Read file: header.php

---

最後に、front-page.phpなどのメインセクションを含むファイルを編集して、midnight.jsで使用するセクション属性を追加します。

---

Read file: front-page.php

---

良いことに、front-page.phpには既に `data-midnight` 属性が設定されています。各セクションに下記の値が設定されています：

1. ヒーローセクション: `data-midnight="default"`
2. 会社メッセージセクション: `data-midnight="white"`
3. 事業内容セクション: `data-midnight="default"`
4. 実績セクション: `data-midnight="default"`
5. ギャラリーセクション: `data-midnight="white"`
6. サイトリンクセクション: `data-midnight="default"`

現在は「default」と「white」の2種類だけですが、これを「blue」「red」「green」に一部変更します。

---

```diff
  
      <!-- 会社メッセージセクション -->
-     <section class="front-page__section front-page__message" data-midnight="white">
+     <section class="front-page__section front-page__message" data-midnight="blue">
          <div class="front-page__message-inner inner">
  
```

```diff
  
      <!-- 事業内容セクション -->
-     <section class="front-page__section front-page__services" data-midnight="default">
+     <section class="front-page__section front-page__services" data-midnight="red">
          <div class="front-page__services-inner inner">
              <h2 class="services-large-title front-page__section-large-title ">Sakura Group<br class="md3-show">Business details</h2>
```

```diff
          </div>
      </section>
-     <section class="front-page__section front-page__gallery" data-midnight="white">
+     <section class="front-page__section front-page__gallery" data-midnight="green">
          <div class="inner">
              <div class="parallax-gallery">
```

---

うまく更新されました。セクションに対してblue、red、greenの色を割り当てました。

最後に、header.phpのmidnightHeaderの構造を調整します。

---

```diff
      <!-- PC用サイドバーナビゲーション -->
      <header class="site-header">
-         <div class="midnightHeader">
+         <div class="midnightHeader default">
+             <nav class="header-nav">
+                 <ul class="header-nav__list">
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("about")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">さくら事務所グループ事業</span>
+                             <span class="header-nav__text-en">About Sakura group</span>
+                         </a>
+                     </li>
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("business")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">さくら事務所グループとは</span>
+                             <span class="header-nav__text-en">Business</span>
+                         </a>
+                     </li>
+                     <li class="header-nav__item">
+                     <a href="<?php echo esc_url(get_post_type_archive_link('staff')); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">メンバー一覧</span>
+                             <span class="header-nav__text-en">Members</span>
+                         </a>
+                     </li>
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("recruit")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">採用情報</span>
+                             <span class="header-nav__text-en">Recruitment Information</span>
+                         </a>
+                     </li>
+               
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("join")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">さくらＧの仲間になる</span>
+                             <span class="header-nav__text-en">Join Sakura group</span>
+                         </a>
+                     </li>
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("press")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">プレスルーム</span>
+                             <span class="header-nav__text-en">Press room</span>
+                         </a>
+                     </li>
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("contact")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">お問い合わせ</span>
+                             <span class="header-nav__text-en">Contact us</span>
+                         </a>
+                     </li>
+                 </ul>
+             </nav>
+         </div>
+         
+         <div class="midnightHeader white">
+             <nav class="header-nav">
+                 <ul class="header-nav__list">
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("about")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">さくら事務所グループ事業</span>
+                             <span class="header-nav__text-en">About Sakura group</span>
+                         </a>
+                     </li>
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("business")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">さくら事務所グループとは</span>
+                             <span class="header-nav__text-en">Business</span>
+                         </a>
+                     </li>
+                     <li class="header-nav__item">
+                     <a href="<?php echo esc_url(get_post_type_archive_link('staff')); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">メンバー一覧</span>
+                             <span class="header-nav__text-en">Members</span>
+                         </a>
+                     </li>
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("recruit")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">採用情報</span>
+                             <span class="header-nav__text-en">Recruitment Information</span>
+                         </a>
+                     </li>
+               
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("join")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">さくらＧの仲間になる</span>
+                             <span class="header-nav__text-en">Join Sakura group</span>
+                         </a>
+                     </li>
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("press")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">プレスルーム</span>
+                             <span class="header-nav__text-en">Press room</span>
+                         </a>
+                     </li>
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("contact")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">お問い合わせ</span>
+                             <span class="header-nav__text-en">Contact us</span>
+                         </a>
+                     </li>
+                 </ul>
+             </nav>
+         </div>
+         
+         <div class="midnightHeader blue">
+             <nav class="header-nav">
+                 <ul class="header-nav__list">
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("about")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">さくら事務所グループ事業</span>
+                             <span class="header-nav__text-en">About Sakura group</span>
+                         </a>
+                     </li>
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("business")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">さくら事務所グループとは</span>
+                             <span class="header-nav__text-en">Business</span>
+                         </a>
+                     </li>
+                     <li class="header-nav__item">
+                     <a href="<?php echo esc_url(get_post_type_archive_link('staff')); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">メンバー一覧</span>
+                             <span class="header-nav__text-en">Members</span>
+                         </a>
+                     </li>
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("recruit")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">採用情報</span>
+                             <span class="header-nav__text-en">Recruitment Information</span>
+                         </a>
+                     </li>
+               
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("join")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">さくらＧの仲間になる</span>
+                             <span class="header-nav__text-en">Join Sakura group</span>
+                         </a>
+                     </li>
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("press")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">プレスルーム</span>
+                             <span class="header-nav__text-en">Press room</span>
+                         </a>
+                     </li>
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("contact")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">お問い合わせ</span>
+                             <span class="header-nav__text-en">Contact us</span>
+                         </a>
+                     </li>
+                 </ul>
+             </nav>
+         </div>
+         
+         <div class="midnightHeader red">
              <nav class="header-nav">
                  <ul class="header-nav__list">
```

```diff
              </nav>
          </div>
-        
+         
+         <div class="midnightHeader green">
+             <nav class="header-nav">
+                 <ul class="header-nav__list">
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("about")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">さくら事務所グループ事業</span>
+                             <span class="header-nav__text-en">About Sakura group</span>
+                         </a>
+                     </li>
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("business")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">さくら事務所グループとは</span>
+                             <span class="header-nav__text-en">Business</span>
+                         </a>
+                     </li>
+                     <li class="header-nav__item">
+                     <a href="<?php echo esc_url(get_post_type_archive_link('staff')); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">メンバー一覧</span>
+                             <span class="header-nav__text-en">Members</span>
+                         </a>
+                     </li>
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("recruit")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">採用情報</span>
+                             <span class="header-nav__text-en">Recruitment Information</span>
+                         </a>
+                     </li>
+               
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("join")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">さくらＧの仲間になる</span>
+                             <span class="header-nav__text-en">Join Sakura group</span>
+                         </a>
+                     </li>
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("press")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">プレスルーム</span>
+                             <span class="header-nav__text-en">Press room</span>
+                         </a>
+                     </li>
+                     <li class="header-nav__item">
+                         <a href="<?php echo esc_url(home_url("contact")); ?>" class="header-nav__link">
+                             <span class="header-nav__text-ja">お問い合わせ</span>
+                             <span class="header-nav__text-en">Contact us</span>
+                         </a>
+                     </li>
+                 </ul>
+             </nav>
+         </div>
      </header>
  
```

---

すべての変更が完了しました。各ファイルを要約します：

1. **functions.php**：
   - すでに午前中のjsは適切に導入されていました。

2. **_header.scss**：
   - 青、赤、緑の色のスタイルを追加しました。
   - それぞれのmidnightHeaderクラスに対応するテキスト色と、ホバー時の色を設定しました。

3. **script.js**：
   - midnight.jsの初期化コードを修正し、より詳細な設定を追加しました。
   - セクションのdata属性に基づいてヘッダースタイルを切り替えるように設定しました。

4. **front-page.php**：
   - 各セクションに適したdata-midnight属性を追加しました。
   - 会社メッセージセクションは「blue」、事業内容セクションは「red」、ギャラリーセクションは「green」に設定しました。

5. **header.php**：
   - midnight.jsの仕組みに合わせて、各スタイル（default, white, blue, red, green）に対応するmidnightHeaderコンテナを追加しました。
   - 各コンテナ内に同じナビゲーション構造を配置し、それぞれ異なる色でスタイリングされるようにしました。

これでセクションに応じて自動的にサイトヘッダーのテキストカラーが変わるようになりました。

---

_**User**_

height: 531px;で固定されているんだけど、原因は？


ChatGPT:

思考時間: 56 秒
「height: 531px; にロックされる」典型パターン早見表
原因のタイプ	よく起こるシチュエーション	531 px が付与される仕組み	ぱっと出来る確認・修正
① Midnight.js が nav 要素にインライン高さを書き込む	Midnight.init 時、最初に見つけた .midnightHeader の高さを nav に固定する仕様	$('nav').height( firstHeader.outerHeight() ) が実行される	DevTools で <nav style="height:531px;"> を探す → $('nav').midnight('update') か $('nav').css('height','auto') を後から実行
② CSS で直接指定されている	SCSS の mixin／Bootstrap のユーティリティなどで思わず書き込み	.fixed { height:531px; } がどこかで出力	DevTools「Styles」タブで「strike-through されていない height」を探して元ファイルを修正
③ JS でアスペクト比計算している	16:9 = 0.5625。幅 946 px × 0.5625 ≒ 531 px というよくある計算	el.style.height = el.offsetWidth * 9/16	画面幅を変えて高さが比例して変わるならこのケース。スクリプト側の式を確認
④ min-height / max-height	レスポンシブ対応の break-point で限定指定	min-height:531px が優先される	computed style で min/max-height を探す & 消す

Midnight.js を使っている場合の チェックと対処（1分）
DevTools で確認
要素パネル → <nav> を選択

html
コピーする
編集する
<nav class="global-nav fixed" style="height: 531px;">
のように style 属性 があれば Midnight.js 由来ほぼ確定。

原因

Midnight.js は初期化時に 「一番背が高いヘッダーの高さ」 を nav に書き込みます。

“Keep in mind that all headers need to be the same height” という注意書きあり。
GitHub

素早い回避

js
コピーする
編集する
$(function () {
  const $nav = $('nav.global-nav').midnight();

  // Midnight が高さを書いた直後に上書きしたい場合
  $nav.css('height', 'auto');            // 固定解除
  $(window).on('resize', () => {
    $nav.css('height', 'auto');          // リサイズ時も上書き
  });
});
根本解決

すべての .midnightHeader を同じ高さ（例：80 px）にそろえる

余白が欲しい所は padding ではなく 子要素側 に入れる

nav 自体は height:auto 指定にしておく（JS が書いても !important で上書き可）

Midnight.js を使っていない／原因がわからないときの デバッグ手順
コンピューテッドスタイルを見る
DevTools → Computed タブ → height の横のリンクをクリックすると「どこで設定されたか」がハイライト表示されます。

該当箇所が CSS ファイルなら
ファイル名・行番号が出るので、そこを書き換え／メディアクエリで上書き。

該当箇所が element.style（インライン）なら

JS 検索：grep -R "style.height" src/

jQuery プロジェクトなら：$('[style*=height]') で該当要素を一覧取得してどこで付与したかトレース。

ひとこと
「まずは DevTools の Computed タブで “どこで書かれたか” を確認 → 出どころを潰す」
これだけ覚えておけば、高さに限らずレイアウトの “謎の固定値” はだいたい解決できます👍

---

_**Assistant**_



---

問題は「midnight.js」の挙動にあります。この場合、midnightHeaderの高さが固定されている原因として次のことが挙げられます：

1. **midnight.jsの仕様**: midnightjsは初期化時に最初の`.midnightHeader`要素の高さを計測し、それをすべてのヘッダーに適用します。ライブラリのドキュメントでも「すべてのヘッダーは同じ高さである必要がある」と注意されています。

2. **考えられる解決策**:

   A. 一番簡単な解決策として、script.jsに以下のコードを追加:

   ```javascript
   $(function(){
     // midnightjsの初期化後、高さを自動に設定
     $('.site-header').midnight({
       // 既存の設定
     });   
     // 高さを自動に戻す
     $('.header-nav').css('height', 'auto');
     // ウィンドウサイズが変わっても高さを自動に
     $(window).resize(function() {
       $('.header-nav').css('height', 'auto');
     });
   });
   ```

   B. より根本的な解決策:
   - すべての`.midnightHeader`の内部コンテンツを同じ高さにする
   - CSS側で`.header-nav`に`height: auto !important`を設定する

3. **midnightHeaderの構造**: header.phpで同じナビゲーション構造を5回（default, white, blue, red, green）繰り返していますが、これらに高さの違いがあると発生します。デフォルトの高さ（531px）に固定されてしまいます。

ブラウザのデベロッパーツールで`.header-nav`要素を確認すると、おそらく`style="height: 531px;"`のようなインラインスタイルが付与されているはずです。これはmidnight.jsが自動的に適用したものです。

---

_**User**_

高さを画面幅いっぱいにしたい

---

_**Assistant**_



---

script.jsファイルを編集して、ヘッダーの高さを画面の高さいっぱい(100vh)に設定します。

---

```diff
        sectionSelector: 'midnight-section', // data-midnight属性を持つ要素を選択
      });   
-     // 高さを自動に戻す
-     $('.header-nav').css('height', 'auto');
-     // ウィンドウサイズが変わっても高さを自動に
+     // 高さを画面いっぱいに設定
+     $('.site-header').css('height', '100vh');
+     $('.header-nav').css('height', '100vh');
+     
+     // ウィンドウサイズが変わっても高さを画面いっぱいに
      $(window).resize(function() {
-       $('.header-nav').css('height', 'auto');
+       $('.site-header').css('height', '100vh');
+       $('.header-nav').css('height', '100vh');
      });
    });
```

---

さらに、CSSも修正して確実に高さが100vhになるようにします。

---

```diff
      align-items: center;
      width: 291px;
-     height: 900px;
+     height: 100vh !important;
  
      // モバイルでは非表示
```

```diff
  .header-nav {
      width: 291px;
-     height: 100%;
+     height: 100vh !important;
      background-color: rgba(255, 255, 255, 0.6);
  }
```

---

また、midnightHeaderの各タイプも同様に高さ100vhに設定しましょう。

---

```diff
  
  /* デフォルト背景（暗い背景）用のスタイル */
+ .midnightHeader.default, 
+ .midnightHeader.white,
+ .midnightHeader.blue,
+ .midnightHeader.red,
+ .midnightHeader.green {
+   height: 100vh !important;
+ }
+ 
  .midnightHeader.default .header-nav__text-ja,
  .midnightHeader.default .header-nav__text-en {
```

---

これで、ヘッダーとナビゲーションが画面の高さいっぱい(100vh)に設定されます。変更点：

1. **JavaScript (script.js) での対応**：
   - `.site-header` と `.header-nav` 両方の高さを `100vh` に設定
   - ウィンドウリサイズ時も同様に高さを維持するように設定

2. **CSS (_header.scss) での対応**：
   - `.site-header` と `.header-nav` の高さを `100vh !important` に設定
   - すべての `.midnightHeader` タイプ (default, white, blue, red, green) にも高さを `100vh !important` に設定

これらの変更により、midnight.js による高さの固定 (531px) を上書きし、ビューポートの高さいっぱいにヘッダーとナビゲーションが表示されるようになります。

---

_**User**_

もセクションに合わせて変更してください

---

_**Assistant**_



---

既存のコードを確認しました。セクションごとのヘッダースタイルを適切に変更するために、front-page.phpの各セクションにdata-midnight属性を設定し、script.jsのmidnight.js初期化部分を更新します。

---

Read file: front-page.php

---

Read file: js/script.js

---

Read file: sass/base/_header.scss

---

